(* SCI channel 1 *)
byte smr1: 0xfffb8;
word brr1: 0xfffb9;
long scr1: 0xfffba;
byte tdr1: 0xfffbb;
byte ssr1: 0xfffbc;
byte rdr1: 0xfffbd;
word count;
byte c;
long s;

begin
	scr1 := 0;	(* init *)
	smr1 := 0;	(* async, 8bits, np, stop1 *)
	brr1 := 51;	(* 9600bps *)
	count := 280;
	while count <> 0 do count := count - 1;
	scr1 := 0x30;
	c := ssr1;
	ssr1 := 0x80;

	c := '*';
loop:
	s := ssr1;
	while (s and 0x80) = 0 do s:= ssr1;
	tdr1 := c;
	ssr1 := s and 0x7F;
	
	repeat
	begin
		s := ssr1;
		while (s and 0x78) = 0 do
		begin
			s:= ssr1;
			if (s and 0x40) <> 0 then (* read ok *)
			begin
				c := rdr1;
				ssr1 := s and 0xbf;
			end
			else (* read error *)
			begin
				ssr1 := s and 0xc7;
			end;
		end;
	end
	until c <= 0x27;

	goto loop;
end
